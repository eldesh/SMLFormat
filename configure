#!/bin/sh
# simple configuration script 
# @author UENO Katsuhiro
# @author YAMATODANI Kiyoshi

projname=smlformat

prefix=/usr/local
exec_prefix='$(prefix)'
compiler=smlsharp
mllex=smllex
mlyacc=smlyacc

for opt in "$@"
do
  optarg=`expr "x$opt" : 'x[^=]*=\(.*\)'`
  case "$opt" in
    --prefix=*) prefix="$optarg" ;;
    --exec_prefix=*) exec_prefix="$optarg" ;;
    --with-smlsharp) compiler="$optarg" ;;
    --with-mllex) mllex="$optarg" ;;
    --with-mlyacc) mlyacc="$optarg" ;;
    --help)
      echo "Usage: $0 OPTIONS..."
      echo
      echo "Options:"
      echo "--help                print this message."
      echo "--prefix=DIR          install files to DIR [default=$prefix]"
      echo "--exec-prefix=DIR     isntall executables to DIR [default=$prefix]"
      echo "--with-smlsharp       use SML# [default=smlsharp]"
      echo "--with-mllex          use MLLex [default=smllex]"
      echo "--with-mlyacc         use MLYacc [default=smlyacc]"
      ;;
    *)
      echo "$0: error: unrecognized option: $opt" 1>&2
      echo "Try \`$0 --help' for more information." 1>&2
      exit 1
      ;;
  esac
done

echo "SML compiler for building $projname... $compiler"

cat > commonrule <<EOF
# This file is automatically generated by configure script.
prefix = $prefix
exec_prefix = $exec_prefix
bindir = \$(exec_prefix)/bin
libdir = \$(prefix)/lib
libdir_$projname = \$(libdir)/$projname
heapdir = \$(libdir_$projname)/heap
MLYACC = $mlyacc
MLLEX = $mllex
SMLDOC = smldoc
INSTALL = install
INSTALL_PROGRAM = \$(INSTALL)
INSTALL_DATA = \$(INSTALL)
SML_COMPILER = $compiler
SMLSHARP_HEAPSIZE = 512M:2G
MAKESML = SMLSHARP_HEAPSIZE=\$(SMLSHARP_HEAPSIZE) \$(SML_COMPILER)
# commonrule ends here.
EOF

for i in \
  Makefile
do
  echo "creating $i"
  sed "
s|@srcdir_$projname@|.|
s|@builddir@|.|
s|@top_srcdir@|.|
s|@top_builddir@|.|
  " "$i.in" > "$i"
done

# configure ends here.
